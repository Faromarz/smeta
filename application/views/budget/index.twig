{% extends "layout/html.twig" %}
{% block content %}
    <link rel="stylesheet" type="text/css" href="{{ Url.media('media/css/budget.css') }}" />

    <script type="text/javascript" src="{{ Url.media('/media/js/class/work.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/material.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/category.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/loaded.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/window.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/door.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/height.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/type.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/class/room.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('/media/js/main_page/smeta.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('media/js/budget_page/budget.js') }}"></script>
    <script type="text/javascript" src="{{ Url.media('media/js/jquery.mCustomScrollbar.js') }}"></script>
    
    <script>
        $(document).ready(function(){
            Budget.init({
                types: {rate:{{ smeta.rate_id }},repair:{{ smeta.repair_id }},apartment:{{ smeta.apartment_id }}},
                params: {{ _params| json_encode()|raw }},
                smeta: {{ smeta_array| json_encode()|raw }},
                doors: {{ doors | json_encode()|raw }},
                windows: {{ windows | json_encode()|raw }},
                smetaId: {{ smeta.id }}
            });
        });
    </script>
    <div id="content">
        <p id="budget_dop_options-hide">скрыть параметры</p>
        <div id="budget_dop_options">
            <p id="budget_dop_options_header">Дополнительные параметры вашей квартиры</p>
            {% include 'block/room.twig' %}
            <div id="dop_options_footer">
                <div id="dop_options_footer_rezult">
                    <h1>{{ smeta.room_name }}</h1>
                    <h2>Общая площадь:</h2>
                    <h3>{{ smeta.size |number_format(2, ',', ' ')}} м²</h3>
                </div>
                <div id="dop_options_button_calculate"><p>пересчитать смету</p></div>
            </div>
        </div>

        <div id="budget_repair_estimate">
            <div id="budget_repair_estimate-type_and_rate">
                <dl class="budget_repair_estimate-type">
                    <dt>{{ smeta.room_name }}:</dt>
                    <dd>{{ smeta.size | number_format(2, ',', ' ') }} м²</dd>
                    <dt>высота потолков:</dt>
                    <dd>{{ smeta.height | number_format(2, ',', ' ') }} м</dd>
                </dl>

                <dl class="budget_repair_estimate-rate">
                    <dt>Тариф:</dt>
                    <dd>{{ smeta.rate.name }}</dd>
                    <p class="dote">•</p>
                    <dt>Ремонт:</dt>
                    <dd>{{ smeta.repair.name }}</dd>
                    <p class="dote">•</p>
                    <dt>Тип квартиры:</dt>
                    <dd>{{ smeta.apartment.name }}</dd>
                </dl>
            </div>

            <a id="change_budget">ИЗМЕНИТЬ ПАРАМЕТРЫ</a>

            <div id="budget_repair_estimate-header">

                <p id="your_budget">ваша</p>
                <h1>Смета ремонта</h1>

                <a href="#" class="xls"></a>
                <a href="#" class="pdf"></a>
                <h2>Цены и сметы от ремонтных компаний</h2>
            </div>

            <div id="budget_repair_estimate-scrolling">

                <div id="budget_repair_estimate-scrolling-left_arrow"></div>

                <div class="budget_repair_estimate-scrolling-external_unit">
                    <div class="budget_repair_estimate-scrolling-inner_unit">
                        <div class="firm firm_selected">
                            <div class="firm_conteyner">

                                <h1>XXX XXX XXX р.</h1>
                                <div class="stamp stamp_5stars"></div>
                                <p class="firm_name">Стоимость материалов:</p>
                                <p class="firm_price">XXX XXX р.</p>
                                <p class="firm_name">Стоимость работ:</p>
                                <p class="firm_price">XXX XXX р.</p>

                                <div class="firm_rate rate_5"></div>
                                <h2>ООО «СтройРемонтСервис»</h2>

                                <div class="firm_logo"></div>
                                <h3>Росссия</h3>
                                <h5>Москва</h5>
                                <h6>+7 (XXX) XXX-XX-XX</h6>
                                <a href="#">сайт компании</a>

                            </div>
                        </div>
                        <div class="firm">
                            <div class="firm_conteyner">

                                <h1>XXX XXX XXX р.</h1>
                                <div class="stamp stamp_4stars"></div>
                                <p class="firm_name">Стоимость материалов:</p>
                                <p class="firm_price">XXX XXX р.</p>
                                <p class="firm_name">Стоимость работ:</p>
                                <p class="firm_price">XXX XXX р.</p>

                                <div class="firm_rate rate_4"></div>
                                <h2>ООО «СтройРемонтСервис»</h2>

                                <div class="firm_logo"></div>
                                <h3>Росссия</h3>
                                <h5>Москва</h5>
                                <h6>+7 (XXX) XXX-XX-XX</h6>
                                <a href="#">сайт компании</a>

                            </div>
                        </div>
                        <div class="firm">

                            <div class="firm_conteyner">

                                <h1>XXX XXX XXX р.</h1>
                                <div class="stamp stamp_4stars"></div>
                                <p class="firm_name">Стоимость материалов:</p>
                                <p class="firm_price">XXX XXX р.</p>
                                <p class="firm_name">Стоимость работ:</p>
                                <p class="firm_price">XXX XXX р.</p>

                                <div class="firm_rate rate_4"></div>
                                <h2>ООО «СтройРемонтСервис»</h2>

                                <div class="firm_logo"></div>
                                <h3>Росссия</h3>
                                <h5>Москва</h5>
                                <h6>+7 (XXX) XXX-XX-XX</h6>
                                <a href="#">сайт компании</a>

                            </div>
                        </div>
                        <div class="firm">
                            <div class="firm_conteyner">

                                <h1>XXX XXX XXX р.</h1>
                                <div class="stamp stamp_4stars"></div>
                                <p class="firm_name">Стоимость материалов:</p>
                                <p class="firm_price">XXX XXX р.</p>
                                <p class="firm_name">Стоимость работ:</p>
                                <p class="firm_price">XXX XXX р.</p>

                                <div class="firm_rate rate_4"></div>
                                <h2>ООО «СтройРемонтСервис»</h2>

                                <div class="firm_logo"></div>
                                <h3>Росссия</h3>
                                <h5>Москва</h5>
                                <h6>+7 (XXX) XXX-XX-XX</h6>
                                <a href="#">сайт компании</a>

                            </div>
                        </div>
                    </div>
                </div>
                <div id="budget_repair_estimate-scrolling-right_arrow"></div>
            </div>

            <div id="budget_repair_estimate-bottom">
                <p class="budget_repair_estimate-bottom-arrow_down">Принцип формирования цены</p>
                <div id="mail">
                    <input placeholder="Ваш номер телефона" />
                    <div id="mail_send">Оставить заявку</div>
                </div>
            </div>
        </div>

        <div id="budget_repair_estimate-slide_menu">
            <div class="budget_repair_estimate-slide_menu-slide1"></div>
            <div class="budget_repair_estimate-slide_menu-slide2"></div>
            <div class="budget_repair_estimate-slide_menu-slide3"></div>
        </div>

        <div id="steel_roll_down"></div>
        <div class="budget_basic_options">
            <div class="budget_basic_options_header">
                <dl>
                    <dd id="dem-work-price">{{ smeta.price_work_dem|number_format(0, ',', ' ') }} р.</dd>
                    <dt>Общая сумма:</dt>
                </dl>
                <dl>
                    <dd id="dem-work-watch">{{ smeta.time_work_dem|number_format(0, ',', ' ') }} часов</dd>
                    <dt>Общее время:</dt>
                </dl>
                <h1>демонтажные работы</h1>
                <div class="ignore_2 ignore_for_basic_options_header dem-work"></div>

            </div>

            {% for room in smeta.rooms.where('show','=',1).order_by('room_id','ASC').find_all() %}
                <div class="budget_basic_options_name style{% if loop.index % 2 == 0 %}2{% else %}1{% endif %}">
                    <div class="slide{% if loop.index % 2 == 0 %}2{% else %}1{% endif %} budget_basic_options_name_style{% if loop.index % 2 == 0 %}2{% else %}1{% endif %}_down">
                        <h2>Стоимость</h2>
                        <h2>Трудочасы</h2>
                        <h2>Объем работ</h2>
                        <h1>{{ room.room.name }}</h1>
                    </div>
                    <div class="ignore_4 room-work-dem-enable" data-room-id="{{ room.room_id }}"></div>
                    <ul>
                        {% for work in smeta.works.find_all() %}
                            {% if work.works.type==0 and room.room.id==work.room_id %}
                                <li>
                                    <p>{{ work.price|number_format(2, ',', ' ') }} р.</p>
                                    <p>{{ work.works.watch }}</p>
                                     <div class="budget_basic_options_job">
                                        <h3>{% if work.works.unit|raw == 'шт.' %}{{ work.count|number_format(0, ',', ' ') }}{% else %}{{ work.count }}{% endif %}</h3>
                                        <h6>{{ work.works.unit|raw }}</h6>
                                        <input  value="0" />
                                    </div>
                                    <h5>{{ work.works.name }}</h5>
                                    <div class="ignore{{  work.enable ? '': 'd' }}_5 dem-work-enable" data-room-id="{{ room.room_id }}" data-work-id="{{ work.works.id }}"></div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}

            <div class="budget_basic_options_rasporka"></div>

        </div>

        <div class="budget_basic_options">
            <div class="budget_basic_options_header">
                <dl>
                    <dd id="mon-work-price">{{ smeta.price_work_mon|number_format(0, ',', ' ') }} р.</dd>
                    <dt>Общая сумма:</dt>
                </dl>
                <dl>
                    <dd id="mon-work-watch">{{ smeta.time_work_mon|number_format(0, ',', ' ') }} часов</dd>
                    <dt>Общее время:</dt>
                </dl>
                <h1>монтажные работы</h1>
                <div class="ignore_2 ignore_for_basic_options_header mon-work"></div>
            </div>

            {% for room in smeta.rooms.where('show','=',1).order_by('room_id','ASC').find_all() %}
                <div class="budget_basic_options_name style{% if loop.index % 2 == 0 %}2{% else %}1{% endif %}">
                    <div class="slide{% if loop.index % 2 == 0 %}2{% else %}1{% endif %} budget_basic_options_name_style{% if loop.index % 2 == 0 %}2{% else %}1{% endif %}_down">
                        <h2>Стоимость</h2>
                        <h2>Трудочасы</h2>
                        <h2>Объем работ</h2>
                        <h1>{{ room.room.name }}</h1>
                    </div>
                    <div class="ignore_4 room-work-mon-enable" data-room-id="{{ room.room_id }}"></div>
                        {% for cat_work in cat_works %}
                            {% if smeta.count_categories_works(1,cat_work.id,room.room.id) > 0 %}
                                <ul class="budget_basic_options_list-{{ cat_work.id }}">
                                    <li></li>
                                    {% for work in smeta.works.find_all() %}
                                        {% if work.works.category_id==cat_work.id and work.works.type==1 and room.room.id==work.room_id %}
                                            <li>
                                                <p>{{ work.price|number_format(2, ',', ' ') }} р.</p>
                                                <p>{{ work.works.watch }}</p>
                                                <div class="budget_basic_options_job">
                                                    <h3>{% if work.works.unit|raw == 'шт.' %}{{ work.count|number_format(0, ',', ' ') }}{% else %}{{ work.count }}{% endif %}</h3>
                                                    <h6>{{ work.works.unit|raw }}</h6>

                                                    <input  value="0" />
                                                </div>
                                                <h5>{{ work.works.name }}</h5>
                                                <div class="ignore{{  work.enable ? '': 'd' }}_5 mon-work-enable" data-room-id="{{ room.room_id }}" data-work-id="{{ work.works.id }}"></div>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% endfor %}
                </div>
            {% endfor %}
            <div class="budget_basic_options_rasporka"></div>
        </div>

        <div class="budget_basic_options">

            <div class="budget_basic_options_header">
                <dl>
                    <dd id="budget_materials_summ">{{ smeta.price_materials|number_format(0, ',', ' ') }} р.</dd>
                    <dt>Общая сумма:</dt>
                </dl>
                <p class="budget_basic_options_header_header">МАТЕРИАЛЫ ДЛЯ РЕМОНТА<p>
                <div class="ignore_2 ignore_for_basic_options_header" id="smetaMaterialsEnable"></div>
            </div>

            {% for key, room in _rooms %}
                <div class="budget_basic_options_name_materials style{% if loop.index % 2 == 0 %}2{% else %}1{% endif %}"{% if room.show == false %} style="display:none;"{% endif %}>
                    <div class="slide{% if loop.index % 2 == 0 %}2{% else %}1{% endif %} budget_basic_options_name_style{% if loop.index % 2 == 0 %}2{% else %}1{% endif %}_down">
                        <p class="budget_basic_options_name_materials_header">{{ room.name }}<p>
                    </div>
                    <div class="ignore_4 room-material-enable" data-room-id="{{ room.id }}"></div>

                    <ul data-material-block-room-id="{{ room.id }}" class="materials_room_for_options budget_basic_options_name_materials_block">
                    </ul>
                </div>
            {% endfor %}

            <div class="budget_basic_options_rasporka"></div>
        </div>
        <div class="budget_basic_options_rasporka2"></div>

    </div>

    <div id="content_bottom">

        <div id="reviews_left_corner">

            <div id="budget-content_bottom-left">


                <h1>Общая стоимость ремонта вашей квартиры:</h1>
                <h2>XXX XXX XXX р.</h2>
                <div id="budget-content_bottom-left-sale"><h3>- XX XXX Р.</h3></div>
                <dl>
                    <dt>Стоимость материалов:</dt>
                    <dd>XXX XXX р.</dd>
                </dl>
                <dl>
                    <dt>Стоимость работ:</dt>
                    <dd>XXX XXX р.</dd>
                </dl>
                <p>Скачать смету <a href="#">в pdf-формате</a> / <a href="#">в xls-формате</a></p>
            </div>

            <div id="budget-content_bottom-center">
                <p>В личном кабинете вы можете:</p>
                <p>— заказать ремонт в вашей квартире</p>
                <p>— контролировать стадии ремонта</p>
                <h1>какие работы уже произведены из списка</h1>
                <h1>сметы, видеть фото-отчёты</h1>
                <a>перейти в личный кабинет</a>
            </div>
        </div>

        <div id="reviews_right_corner">

            <h1>Страховка вашей квартиры + ГО<br>на <span>500 000</span> рублей</h1>
            <h2>при заказав ремонта от 100 000 рублей </h2>
            <a href="#">Узнать подробности</a>

        </div>
    </div>
{% endblock content %}